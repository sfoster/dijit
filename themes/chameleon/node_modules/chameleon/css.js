var fs = require('fs');
var chameleon = require('chameleon');

module.exports = function(req, res, context){
  console.log("css module, has req: " + req);
  console.log("css module, context: " + JSON.stringify(context));
  var resource = context.resource, 
    path = context.themeDir + "/" + chameleon.transform(context.resource, {
      name: ['chameleon', 'claro']
    }), 
    mtype = 'text/css';
  fs.readFile(path, function (err, data) {
    if (err) throw err;
    var str = chameleon.transform(data.toString(), context.transform);
    res.send(str, { 'Content-Type': mtype }, 200);
  });
}